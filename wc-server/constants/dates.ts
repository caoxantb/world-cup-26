import tzlookup from "tz-lookup";
import { DateTime } from "luxon";

import { range } from "../utils";

const getMatchdateWindows = (windows: number[], federation: string) => {
  const WINDOWS_BASEDATE = [
    "2023-10-09",
    "2023-10-13",
    "2023-11-13",
    "2023-11-17",
    "2024-03-18",
    "2024-08-22",
    "2024-06-03",
    "2024-06-07",
    "2024-09-02",
    "2024-09-06",
    "2024-10-07",
    "2024-10-11",
    "2024-11-11",
    "2024-11-15",
    "2025-03-17",
    "2025-03-21",
    "2025-06-02",
    "2025-06-06",
    "2025-09-01",
    "2025-09-05",
    "2025-10-06",
    "2025-10-10",
    "2025-10-10",
    "2025-10-14",
  ];

  const FEDERATIONS_OFFSET: { [key: string]: number } = {
    AFC: 12,
    CAF: 17,
    CONCACAF: 24,
    CONMEBOL: 47,
    OFC: 54,
    UEFA: 65,
  };

  const dates = windows.map((window) => {
    const baseDate = new Date(WINDOWS_BASEDATE[window]);
    const offsetDate = new Date(
      baseDate.getTime() + FEDERATIONS_OFFSET[federation] * 60 * 60 * 1000
    );
    return offsetDate;
  });

  return dates;
};

export const getDates = (code: string, hosts: number) => {
  const DATES: { [key: string]: number[] } = {
    "AFC-1st": range(0, 1),
    "AFC-2nd": range(2, 7),
    "AFC-3rd": range(8, 17),
    "AFC-4th": range(18, 20),
    "AFC-5th": range(22, 23),
    "CAF-PRE": !hosts ? [] : range(0, 1),
    "CAF-1st": [
      ...range(2, 3),
      ...range(6, 7),
      ...(hosts === 3 ? range(8, 9) : []),
      ...range(10, 11),
      ...range(14, 15),
      ...(hosts === 3 ? range(16, 17) : []),
      ...range(18, 19),
    ],
    "CAF-PO-SF": [20],
    "CAF-PO-F": [21],
    "CONCACAF-1st": range(2, 3),
    "CONCACAF-2nd": range(4, 3),
    "CONCACAF-3rd": [...range(14, 15), ...range(18, 21)],
    "CONCACAF-PO-F": range(22, 23),
    "CONMEBOL-GS": [
      ...range(0, 3),
      ...(hosts === 3 ? range(4, 5) : []),
      ...range(8, 17),
      ...(hosts !== 2 ? range(18, 21) : []),
      ...(hosts === 3 ? [22] : []),
    ],
    "OFC-PRE-SF": [10],
    "OFC-PRE-F": [11],
    "OFC-1st": hosts === 0 ? range(10, 12) : range(12, 14),
    "OFC-2nd": [16],
    "OFC-3rd": [17],
    "UEFA-NL-A": [...range(2, 5), ...range(8, 9)],
    "UEFA-NL-B": [...range(2, 5), ...range(8, 9)],
    "UEFA-NL-C": [...range(2, 5), ...range(8, 9)],
    "UEFA-NL-D": [...range(2, 5), ...range(8, 9)],
    "UEFA-NL-PO": range(10, 11),
    "UEFA-NL-QF": range(10, 11),
    "UEFA-NL-SF": [16],
    "UEFA-NL-F": [17],
    "UEFA-GS": range(12, 21),
    "UEFA-PO-SF": [22],
    "UEFA-PO-F": [23],
  };

  const federation = code.split("-")[0];

  const dates = getMatchdateWindows(DATES[code], federation);

  return dates;
};

export const getDatetimeWithTimezone = (
  datetime: string,
  finalVenueCoord: number[]
) => {
  const [lat, lon] = finalVenueCoord;
  const zone = tzlookup(lat, lon);
  const dtUTC = DateTime.fromISO(datetime, { zone }).toUTC().toISO() || "";

  return dtUTC;
};

export const getWorldCupDates = (code: string) => {
  const DATES: { [key: string]: string[] } = {
    "FIFA-INTERPO-SF": [
      "2026-03-25T18:00:00.000",
      "2026-03-25T22:00:00.000",
      "2026-03-26T18:00:00.000",
      "2026-03-26T22:00:00.000",
    ],
    "FIFA-INTERPO-F": ["2026-03-31T18:00:00.000", "2026-03-31T22:00:00.000"],
    "FIFA-WC-GS": [
      "2026-06-07T19:00:00.000",
      "2026-06-07T22:00:00.000",
      "2026-06-08T16:00:00.000",
      "2026-06-08T19:00:00.000",
      "2026-06-08T22:00:00.000",
      "2026-06-09T13:00:00.000",
      "2026-06-09T16:00:00.000",
      "2026-06-09T19:00:00.000",
      "2026-06-09T22:00:00.000",
      "2026-06-10T13:00:00.000",
      "2026-06-10T16:00:00.000",
      "2026-06-10T19:00:00.000",
      "2026-06-10T22:00:00.000",
      "2026-06-11T13:00:00.000",
      "2026-06-11T16:00:00.000",
      "2026-06-11T19:00:00.000",
      "2026-06-11T22:00:00.000",
      "2026-06-12T13:00:00.000",
      "2026-06-12T16:00:00.000",
      "2026-06-12T19:00:00.000",
      "2026-06-12T22:00:00.000",
      "2026-06-13T16:00:00.000",
      "2026-06-13T19:00:00.000",
      "2026-06-13T22:00:00.000",
      "2026-06-14T13:00:00.000",
      "2026-06-14T16:00:00.000",
      "2026-06-14T19:00:00.000",
      "2026-06-14T22:00:00.000",
      "2026-06-15T13:00:00.000",
      "2026-06-15T16:00:00.000",
      "2026-06-15T19:00:00.000",
      "2026-06-15T22:00:00.000",
      "2026-06-16T13:00:00.000",
      "2026-06-16T16:00:00.000",
      "2026-06-16T19:00:00.000",
      "2026-06-16T22:00:00.000",
      "2026-06-17T13:00:00.000",
      "2026-06-17T16:00:00.000",
      "2026-06-17T19:00:00.000",
      "2026-06-17T22:00:00.000",
      "2026-06-18T13:00:00.000",
      "2026-06-18T16:00:00.000",
      "2026-06-18T19:00:00.000",
      "2026-06-18T22:00:00.000",
      "2026-06-19T13:00:00.000",
      "2026-06-19T16:00:00.000",
      "2026-06-19T19:00:00.000",
      "2026-06-19T22:00:00.000",
      "2026-06-20T18:00:00.000",
      "2026-06-20T18:00:00.000",
      "2026-06-20T22:00:00.000",
      "2026-06-20T22:00:00.000",
      "2026-06-21T18:00:00.000",
      "2026-06-21T18:00:00.000",
      "2026-06-21T22:00:00.000",
      "2026-06-21T22:00:00.000",
      "2026-06-22T18:00:00.000",
      "2026-06-22T18:00:00.000",
      "2026-06-22T22:00:00.000",
      "2026-06-22T22:00:00.000",
      "2026-06-23T18:00:00.000",
      "2026-06-23T18:00:00.000",
      "2026-06-23T22:00:00.000",
      "2026-06-23T22:00:00.000",
      "2026-06-24T18:00:00.000",
      "2026-06-24T18:00:00.000",
      "2026-06-24T22:00:00.000",
      "2026-06-24T22:00:00.000",
      "2026-06-25T18:00:00.000",
      "2026-06-25T18:00:00.000",
      "2026-06-25T22:00:00.000",
      "2026-06-25T22:00:00.000",
    ],
    "FIFA-WC-R32": [
      "2026-06-26T19:00:00.000",
      "2026-06-26T22:00:00.000",
      "2026-06-27T16:00:00.000",
      "2026-06-27T19:00:00.000",
      "2026-06-27T22:00:00.000",
      "2026-06-28T16:00:00.000",
      "2026-06-28T19:00:00.000",
      "2026-06-28T22:00:00.000",
      "2026-06-29T16:00:00.000",
      "2026-06-29T19:00:00.000",
      "2026-06-29T22:00:00.000",
      "2026-06-30T16:00:00.000",
      "2026-06-30T19:00:00.000",
      "2026-06-30T22:00:00.000",
      "2026-07-01T19:00:00.000",
      "2026-07-01T22:00:00.000",
    ],
    "FIFA-WC-R16": [
      "2026-07-03T18:00:00.000",
      "2026-07-03T22:00:00.000",
      "2026-07-04T18:00:00.000",
      "2026-07-04T22:00:00.000",
      "2026-07-05T18:00:00.000",
      "2026-07-05T22:00:00.000",
      "2026-07-06T18:00:00.000",
      "2026-07-06T22:00:00.000",
    ],
    "FIFA-WC-QF": [
      "2026-07-08T18:00:00.000",
      "2026-07-09T18:00:00.000",
      "2026-07-10T18:00:00.000",
      "2026-07-11T18:00:00.000",
    ],
    "FIFA-WC-SF": ["2026-07-14T18:00:00.000", "2026-07-15T18:00:00.000"],
    "FIFA-WC-3P": ["2026-07-18T18:00:00.000"],
    "FIFA-WC-F": ["2026-07-19T18:00:00.000"],
  };

  return DATES[code];
};
